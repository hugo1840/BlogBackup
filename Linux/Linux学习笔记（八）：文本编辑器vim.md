@[TOC](Linux学习笔记（八）：文本编辑器vim)
# vi的使用
vi是所有Linux系统都会内置的文本编辑器，而vim是vi的进阶版本，可以用颜色和底线显示一些特殊信息（配置信息、shell脚本语法检查等）。vi的使用可以分为一般指令模式、编辑模式、指令列命令模式。其中，由一般命令模式可以切换到另外两种模式，但是后两种模式之间不能相互切换。

**一般指令模式（command mode）**
默认使用vi打开文件时即进入该模式。该模式下可以移动光标，并进行删除、复制、粘贴等操作。

**编辑模式（insert mode）**
在一般指令模式下，按下 ==**i, I, o, O, a, A, r, R**== 中的任意字母即可进入编辑模式，画面左下方会出现 INSERT 或 REPLACE 的字样。该模式下可以对文本文件进行编辑。按下 **Esc** 键可以返回到一般指令模式。

**指令列命令模式（command-line mode）**
在一般指令模式下，输入 ==**: / ?**== 三者中的任意一个符号即可进入指令列命令模式。该模式下可以进行搜索或替换文本、显示行号、保存编辑内容、退出vi程序等操作。

## 一般指令模式
**移动光标的方法**
| 按键 | 作用 |
| :--: | :--: |
| h或向左箭头 | 向左移动一个字符 |
| j或向下箭头 | 向下移动一个字符 |
| k或向上箭头 | 向上移动一个字符 |
| l或向右箭头 | 向右移动一个字符 |
| Ctrl f | 屏幕向下翻一页，相当于PageDown（**常用**） |
| Ctrl b | 屏幕向上翻一页，相当于PageUp（**常用**） |
| Ctrl d | 屏幕向下翻半页 |
| Ctrl u | 屏幕向上翻半页 |
| + | 移动到下一行开头 |
| - | 移动到上一行开头 |
| n空格键 | 向右移动n个字符 |
| 0或home键 | 移动到当前行的开头（**常用**） |
| $或end键 | 移动到当前行的结尾（**常用**） |
| H | 移动到屏幕最上方一行的开头 |
| M | 移动到屏幕中央一行的开头 |
| L | 移动到屏幕最下方一行的开头 |
| G | 移动到文件最后一行（**常用**） |
| nG | 移动到文件的第n行 |
| gg | 移动到文件的第一行（**常用**） |
| n回车键 | 向下移动n行（**常用**） |

**文本搜索与替换**
| 按键 | 作用 |
| :--: | :--: |
| /word | 在光标下方的文本中搜索字符串word（**常用**） |
| ?word | 在光标上方的文本中搜索字符串word |
| n | 重复前一个搜索动作，与/word或?word配合使用（**常用**） |
| N | 反向进行前一个搜索动作，与/word或?word配合使用 |
| :n1,n2s/word1/word2/g | 在第n1行与第n2行之间搜索字符串word1，并将其替换为word2（**常用**） |
| :1,$s/word1/word2/g | 全文搜索字符串word1并将其替换为word2（**常用**） |
| :1,$s/word1/word2/gc | 全文搜索字符串word1并将其替换为word2，替换之前需要用户确认 |

**删除、复制与粘贴**
| 按键 | 作用 |
| :--: | :--: |
| x或X | x为删除光标后一个字符，X删除前一个字符（**常用**） |
| nx | 向后连续删除n个字符 |
| dd | 删除当前行（**常用**） |
| ndd | 向下删除n行，包括当前行和空白行（**常用**） |
| d1G | 删除第一行到当前行所有内容 |
| dG | 删除当前行到最后一行所有内容 |
| d$ | 删除从光标所在位置到当前行的行尾（包括光标所在字符） |
| d0 | 删除从当前行的行首直到光标所在位置前一个字符（不包括光标所在字符） |
| yy | 复制当前行（**常用**） |
| nyy | 从当前行向下复制n行（**常用**） |
| y1G | 从第一行复制到当前行 |
| yG | 从当前行复制到最后一行 |
| y0 | 复制从当前行的行首直到光标所在位置前一个字符（不包括光标所在字符） |
| y$ | 复制从光标所在位置到当前行的行尾（包括光标所在字符） |
| p或P | p将复制内容粘贴为当前行的下一行，P将复制内容粘贴为当前行的上一行（**常用**） |
| J | 将当前行与下一行合并成一行 |
| c | 重复删除多个数据，5cj向下删除5行，6ck向上删除6行 |
| u | 撤销前一个操作，包括Ctrl r（**常用**） |
| Ctrl r | 还原前一个u撤销操作（**常用**） |
| 小数点. | 重复前一个操作（**常用**） |

## 切换到编辑模式
| 按键 | 作用 |
| :--: | :--: |
| i或I | 进入插入模式（Insert mode）：i为从光标表所在位置前插入，I为从当前行第一个非空字符前插入 |
| o或O | 进入插入模式（Insert mode）： a为从光标所在位置后一个字符插入，A为从当前行最后一个字符插入|
| a或A | 进入插入模式（Insert mode）：o为在光标所在位置的下一行插入新的一行，O为在当前行的上一行插入新的一行 |
| r或R | 进入替换模式（Replace mode）：r为取代光标所在位置的一个字符，R为取代光标所在位置的字符，直到按下Esc键 |

## 指令列命令模式
| 按键 | 作用 |
| :--: | :--: |
| :w | 将编辑的数据写入硬盘文件（**常用**） |
| :w! | 文件属性为只读时， 强制将编辑的数据写入硬盘文件 |
| :q | 退出vi（**常用**） |
| :q! | 强制退出vi，不保留修改过的内容 |
| :wq | 保存修改的内容后退出vi（**常用**） |
| ZZ | 退出vi，若文件被修改则保留修改内容，未被修改则不保存直接退出 |
| :w filename | 将编辑过的文件内容另存为名为filename的文件（**常用**） |
| :r filename | 将filename文件中的内容添加到当前光标所在位置的下一行 |
| :n1,n2 w filename | 将当前文档第n1行至第n2行的内容另存为名为filename的文件 |
| :! command | 暂时离开指令列模式并执行command命令，如:! ls /home（**常用**） |
| :set nu | 在每一行前显示行号（**常用**） |
| :set nonu | 取消显示行号 |

# vim的额外功能
## 区块选择
一般指令模式下，按下 ==v、V 或者 Ctrl v== 即可进入区块选择，此时屏幕左下方会显示-\-**VISUAL BLOCK**-\-字样。区块选择状态下，移动光标可以选择文本区块，并进行删除、复制和粘贴操作。
| 按键 | 作用 |
| :--: | :--: |
| v | 按下后会将光标经过的字符反白选择 |
| V | 按下后会将光标经过的行反白选择 |
| Ctrl v | 按下后通过上下左右移动光标可以反白选择矩形文本区块 |
| d | 删除反白选择的区块 |
| y | 复制反白选择的区块 |
| p | 在当前位置粘贴复制的文本区块 |

## 多文件编辑
使用 ==vim file1 file2 file3 ...== 指令可以同时打开多个文件，并进行如下指令列命令操作。
| 按键 | 作用 |
| :--: | :--: |
| :n | 编辑下一个文件 |
| :N | 编辑上一个文件 |
| :files | 在屏幕下方显示所有打开的文件信息 |

## 多窗口
一般指令模式下，输入 **:sp** 可以进入多窗口模式，并进行如下操作。
| 按键 | 作用 |
| :--: | :--: |
| :sp filename | 在新窗口中打开文件filename，如果filename缺失<br>则新窗口的内容会与当前窗口的内容相同 |
| Ctrl w j (或者把j换成向下箭头) | 按下Ctrl和w键后，松开两键再按j <br>光标移到到下方的窗口 |
| Ctrl w k (或者把k换成向上箭头) | 按键方式同上。光标移到到上方的窗口 |
| Ctrl w q | 退出，相当于:q |

## 补全功能
在编辑模式下，可以使用vim的字符补全功能。
| 按键 | 作用 |
| :--: | :--: |
| 先按Ctrl x再按Ctrl n | 根据当前文件的内容，补全光标所在位置的字符（常用） |
| 先按Ctrl x再按Ctrl f | 根据当前目录内的文件名，补全光标所在位置的字符 |
| 先按Ctrl x再按Ctrl o | 根据文件扩展名（.html、.php等）和vim内建关键字，补全光标所在位置的字符（常用） |

## 环境设定与记录
vim的环境设定值一般保存在 **/etc/vimrc** 文件中，不建议对其进行修改。一般指令模式下，输入以下指令列命令可以查看或修改vim的环境参数。
| 按键 | 作用 |
| :--: | :--: |
| :set nu <br>:set nonu | 显示行号 <br>不显示行号（默认） |
| :set hlsearch <br>:set nohlsearch | 高亮显示搜索的字符（默认） <br>取消高亮显示搜索的字符 |
| :set autoindent <br>:set noautoindent | 自动缩排（默认） <br>不自动缩排 |
| :set backup | 自动将被修改的文件filename存储为文件filename~ （默认是nobackup）|
| :set ruler | 显示屏幕右下角的状态说明 |
| :set showmode | 显示屏幕左下角的状态说明（比如INSERT/REPLACE等编辑模式） |
| :set backspace=(012) | 默认设定为2，编辑模式下可使用backspace键删除已经存在的字符；设定为0或1时，仅可删除输入的字符  |
| :set all | 显示目前所有的环境参数设定值 |
| :set | 显示与系统默认设定值不同的环境参数 |
| :syntax on <br>:syntax off | 根据程序语法对字符显示不同颜色（默认） <br>取消不同颜色显示 |
| :set bg=dark <br>:set bg=light | 设置背景颜色为较暗 <br>设置背景颜色为较亮（默认） |

