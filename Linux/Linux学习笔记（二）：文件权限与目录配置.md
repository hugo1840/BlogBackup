@[TOC](Linux学习笔记（二）：文件权限与目录配置)
# 用户与群组
在Linux系统中，默认情况下，所有系统账号信息（包括一般用户与root用户）都记录在 **/etc/passwd** 文件内。个人密码则记录在 **/etc/shadow** 文件下。所有组名都记录在 **/etc/group** 文件下。

在普通用户下，使用 **su -** 指令可以切换到root用户身份，再使用 **exit** 指令回到普通用户。

# 文件权限
## Linux文件属性
使用 **ls -al** 指令可以查看当前文件夹下所有文件详细的权限与属性信息（包括隐藏文件）。输出的七列内容依次表示：==文件类型与权限、链接数、文件拥有者、所属群组、文件容量、最后被修改的时间、文件名==。

```bash
[root@study ~]# ls -al
total 48
dr-xr-x---	5	root	root	4096	May 29 16:08	.
dr-xr-xr-x	17	root	root	4096	May 4  17:56	..
drwxr-xr-x	3	root	root	17  	May 6  00:14	.config
-rw-r--r--	1	root	root	1864	May 4  18:01	initial-setup-ks.cfg
```
**文件类型与权限**
第一列共有十个字符：第一个字符代表文件类型，接下来的九个字符以三个为一组，依次代表==文件拥有者、所属群组、其他用户==的权限。
第一个字符可以为 **d**、**-**、**l**、**b**、**c**，依次代表==目录、一般文件、链接文件（link file）、可供存储的接口设备（可随机存取装置）、串行端口设备（一次性读取装置）==。
表示文件权限的字符有 **r**、**w**、**x**、**-** 四个，依次代表==可读、可写、可执行、无权限==。

**链接数**
Linux系统内部使用**索引节点**（**inode**）而不是文件名来识别一个文件。inode存储了文件的元信息，包括文件的创建者、创建日期、文件大小等。每个文件名都会链接到一个inode。ls -al 输出的第二列即表示==有多少不同的文件名链接到同一个inode==。

**文件容量**
文件大小的单位默认为bytes。

**文件名**
如果文件名前面多一个 **.** 则代表是隐藏文件。

## 改变文件属性与权限
改变Linux文件的属性与权限主要借助于 *chgrp*、*chown*、*chmod* 三个指令来实现。

**改变所属群组**
假设要把initial-setup-ks.cfg文件的所属群组改为users。

```bash
chgrp users initial-setup-ks.cfg
```
如果要改变某一目录以及该目录下所有文件和次级目录的所属群组，可以在chgrp指令后加上参数 **-R**。

**改变文件拥有者**
假设要把initial-setup-ks.cfg文件的拥有者改为fang。也可以同时改变文件的拥有者和组，只需使用冒号将拥有者和组名分隔开。如果要改变某一目录以及该目录下所有文件和次级目录的拥有者，可以在chown指令后加上参数 **-R**。改变文件拥有者的操作通常用于复制得到的文件。
```bash
chown fang initial-setup-ks.cfg
chown root:root initial-setup-ks.cfg
```

**改变文件权限**
chmod指令可以使用数字或符号来改变文件的权限。参数 **-R** 同样可用于该指令。

使用数字代号改变文件权限时，上面提到的==r、w、x、- 可以分别用数字4、2、1、0表示==。每种身份的三个权限需要各自进行**累加**。例如，假设文件拥有者和群组的权限都为 rwx，各自累加后都为 4+2+1 = 7，其他用户的权限为 \-\-\-，累加后为0，那么该文件权限对应的数字代号为770。
假设我们按此要求修改文件 .bashrc 的权限。

```bash
chmod 770 .bashrc
```

使用符号修改文件权限时，使用 **u**、**g**、**o**、**a** 分别代表文件拥有者、群组、其他用户，**+**、**-**、**=** 分别代表添加、移除、设定某个权限，**r**、**w**、**x** 分别代表读、写、执行的权限。

假设我们要把文件 .bashrc 的权限修改为 -rwxr-xr--。或者我们不知道文件原有的权限信息，但是需要给所有用户添加写入的权限。又或者我们要移除其他用户的可执行权限。

```bash
chmod u=rwx,g=rx,o=r .bashrc
chmod a+w .bashrc
chmod o-x .bashrc
```

## 权限对目录与文件的意义
文件权限对一般文件与对目录的意义有所不同。
| 文件权限 | 一般文件 | 目录 |
| -- | -- | -- |
| r | 读取文件内容 | 读取目录结构列表 |
| w | 编辑文件内容<br>（不包括删除文件） | 创建新的文件与目录<br> 删除已有的文件或目录<br> 重命名文件或目录<br> 移动文件或目录的位置 |
| x | 可以被系统执行 | 进入该目录（cd指令） |

## 文件种类与扩展名
上面提到了 **d**、**-**、**l**、**b**、**c** 五种文件类型。硬盘和软盘为**b**类文件，而鼠标和键盘为**c**类文件。socket数据接口文件的类型为**s**。FIFO数据传输文件（First-In-First-Out, pipe）的文件类型为**p**。

与Windows不同，Linux文件通常没有扩展名。常见的Linux文件扩展名包括以下三种：
* *.sh：使用shell写成的脚本或批处理文件；
* *.tar, *.tar.gz, *.zip, *.tgz：压缩文件；
* *.html, *.php：网页文件。

# 目录配置
## Linux目录配置的依据：FHS
**根目录**
为了减小发生错误的可能性，==根目录所在分区槽应该越小越好==，且应用程序安装的软件最好不要与根目录在同一个分区槽。File Hierarchy System (FHS) 定义根目录下应该包括以下次目录：
* /bin：放置在单人维护模式下还能被操作的**指令**，包括cat、chmod、chown、date、mv、mkdir、cp、bash等；
* /boot：放置**开机**时使用的文件，包括Linux核心文件、开机选单与开机配置文件。其中Linux kernel的文件名为**vmlinuz**；
* /dev：任何装置与接口**设备**都在这个目录下；
* /etc：放置**系统的主要配置文件**，包括账户密码文件、各种服务的启动文档。一般只有root用户有权限修改该目录下的各文件属性；
* /lib：系统在**开机**时会用到的函数库，以及在/bin和/sbin目录下的指令会调用的**函数库**；
* /media：可移除的装置，包括光盘、软盘、DVD等；
* /mnt：临时挂载的设备，与/media的作用类似；
* /opt：放置**第三方软件**（非distribution提供的），比如KDE桌面管理软件；
* /run：放置系统开机后所产生的各项信息；
* /sbin：放置系统开机、修复或还原系统所需要的**指令**，包括fdisk、fsck、ifconfig、mkfs等；
* /srv：即service，放置某些**网络服务**启动后所需要取用的数据目录，包括WWW服务、FTP服务等；
* /tmp：正在执行的程序**暂时**放置文件的地方；
* /usr：**Unix Software Resource**的缩写，与软件安装和执行有关（下文会详细介绍）；
* /var：即variable，与系统运作过程有关（下文会详细介绍）。

FHS建议根目录下可以存在以下次目录：
* /home：系统默认的用户**家目录**。**~** 代表当前用户的家目录， **~fang** 代表用户fang的家目录；
* /lib< qual>：存放与/lib目录不同格式的二进制函数库；
* /root：系统管理员root的家目录。

根目录下其他可能存在的次目录包括：
* /lost+found：放置文件系统发生错误时遗失的片段。使用标准的ext2/ext3/ext4文件系统格式才会存在该目录；
* /proc：一个“虚拟文件系统”，其中的数据都在**内存**中，包括系统核心、**进程**信息、网络状态等；
* /sys：与/proc类似，该目录不占用硬盘容量，用于纪录与系统核心和硬件相关的信息。

**/usr目录**
根据FHS定义，/usr目录下的文件属于可分享（shareable）但不可变动（static）的的。==所有系统默认的软件（distribution发布者提供的软件）都会放置在该目录下==，类似于Windows系统中的C:\Windows\和C:\Program files\两个目录的结合。一般来说，/usr的次级目录包括：
* /usr/bin/：放置一般用户都能使用的指令；
* /usr/lib/：与/lib功能相同，且/lib链接到该目录中；
* /usr/local/：系统管理员在本机安装的自行下载的软件（非distribution默认提供）；
* /usr/sbin/：非系统正常运转所需要的系统指令，常见的有某些网络服务软件的服务指令（daemon）。/sbin链接到该目录中；
* /usr/share/：放置只读架构的数据文件，以及共享文件；
* /usr/include/：C/C++等程序语言的header和include文件；
* /usr/libexec/：某些不被一般使用者惯用的执行文档或脚本；
* /usr/lib< qual>/：与/lib< qual>功能相同，且后者链接到该目录中；
* /usr/src/：即source，放置一般原始码，而核心原始码可以放在/usr/src/linux/下。

**/var目录**
/usr目录在安装系统时占用的硬盘容量最多，而/var在系统运作后才会逐渐开始占用硬盘容量。/var目录主要针对常态性变动的文件，常见的次级目录包括：
* /var/cache/：应用程序运行过程中产生的暂存文档；
* /var/lib/：程序运行过程中需要使用的**数据文件**；
* /var/lock/：应用程序运行时的锁，已挪至/run/lock目录；
* /var/log/：存放**日志文件**，包括所有服务的登录文件和错误信息文件（非常重要！！！）；
* /var/mail/：个人邮箱目录，与/var/spool/mail/互为链接；
* /var/run/：某些程序或服务启动后的**PID**。该目录链接到/run目录；
* /var/spool/：放置等待其他程序使用的**队列数据**，数据使用后通常会被删除。


## 绝对路径与相对路径
绝对路径（absolute path）是由根目录开始写起的文件名或者目录名，比如 /home/fang/.bashrc。相对路径（relative path）则是相对于当前路径的文件名写法，比如 ./home/fang、. ./. ./home/fang/ 等，==不是以 **/** 直接开头的写法==。

注意到 **./** 代表当前目录，**. ./** 代表上一层目录。假设你在 /home 目录下，需要进入到同在根目录下的 /var/log 目录，可以采用以下两种方法。

```bash
cd /var/log     # absolute path
cd ../var/log   # relative path
```

Question：如何先进入/var/spool/mail/，再进入/var/spool/cron/目录？

```bash
cd /var/spool/mail
cd ../cron
```
Question： **./run.sh** 表示什么意思？
Answer：执行当前目录下的 run.sh 文件。
